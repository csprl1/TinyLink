"use strict";(()=>{var e={};e.id=331,e.ids=[331],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4817:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>g,requestAsyncStorage:()=>h,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>l,POST:()=>d});var s=r(9303),o=r(8716),a=r(670),i=r(7070),u=r(3493);let p=/^[A-Za-z0-9]{6,8}$/;async function l(){let e=await u.Z.link.findMany({orderBy:{createdAt:"desc"}});return i.NextResponse.json(e)}async function d(e){try{let{url:r,code:n}=await e.json();if(!r||"string"!=typeof r)return i.NextResponse.json({error:"URL is required"},{status:400});if(!function(e){try{let t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch{return!1}}(r))return i.NextResponse.json({error:"Invalid URL. Must start with http:// or https://"},{status:400});if(n&&"string"==typeof n){var t;if(t=n=n.trim(),!p.test(t))return i.NextResponse.json({error:"Code must be 6â€“8 alphanumeric characters"},{status:400})}else{let e=!1,t=0;for(;!e&&t<5;){let r=function(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=6+Math.floor(3*Math.random()),r="";for(let n=0;n<t;n++)r+=e[Math.floor(Math.random()*e.length)];return r}();await u.Z.link.findUnique({where:{code:r}})||(n=r,e=!0),t++}if(!n)return i.NextResponse.json({error:"Failed to generate unique code"},{status:500})}if(await u.Z.link.findUnique({where:{code:n}}))return i.NextResponse.json({error:"Code already exists"},{status:409});let s=await u.Z.link.create({data:{code:n,url:r}});return i.NextResponse.json(s,{status:201})}catch(e){return console.error(e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/links/route",pathname:"/api/links",filename:"route",bundlePath:"app/api/links/route"},resolvedPagePath:"/Users/prathameshugale/Desktop/TinyLink/app/api/links/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:m}=c,x="/api/links/route";function g(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:f})}},3493:(e,t,r)=>{r.d(t,{Z:()=>s});let n=require("@prisma/client"),s=global.prisma??new n.PrismaClient({log:["error","warn"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(4817));module.exports=n})();